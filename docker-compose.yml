services:
  phi-server:
    build:
      context: .
      dockerfile: phi_server/Dockerfile
    container_name: phi-server
    ports:
      - "8000:8000"
    environment:
      MODEL_ID: "microsoft/phi-1_5"
      OPENAI_API_KEY: "${OPENAI_API_KEY:-}"
      HF_TOKEN: "${HF_TOKEN:-}"
      NVIDIA_VISIBLE_DEVICES: "all"
      NVIDIA_DRIVER_CAPABILITIES: "compute,utility"
      WARMUP_ON_STARTUP: "1"
    gpus: all
    restart: unless-stopped

  openwebui:
    image: ghcr.io/open-webui/open-webui:main
    container_name: openwebui
    depends_on:
      - phi-server
    ports:
      - "8080:8080"
    environment:
      ENABLE_OPENAI_API: "true"
      OPENAI_API_BASE_URL: "http://phi-server:8000/v1"
      OPENAI_API_BASE_URLS: "http://phi-server:8000/v1"
      OPENAI_API_KEY: "${OPENAI_API_KEY:-local-dev-key}"
      WEBUI_SECRET_KEY: "${WEBUI_SECRET_KEY:-replace-this-secret}"
    restart: unless-stopped
